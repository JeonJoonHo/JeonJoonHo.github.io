<!DOCTYPE html>
<html lang="kr">

  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="keywords" content="" />
  <meta name="author" content="Jeon JoonHo" />
  <meta name="description" content="Hello" />
  
  
  <title>
    
      테스트 주도 개발의 패턴 
      
      
      |
    
     JOON.DEV
  </title>

  
    <link rel="apple-touch-icon" href="/images/favicon.png">
    <link rel="icon" href="/images/favicon.png">
  

  <!-- Raleway-Font -->
  <link href="https://fonts.googleapis.com/css?family=Raleway&display=swap" rel="stylesheet">

  <!-- hexo site css -->
  
<link rel="stylesheet" href="/css/base.css">
<link rel="stylesheet" href="/iconfont/iconfont.css">
<link rel="stylesheet" href="/css/github-markdown.css">
<link rel="stylesheet" href="/css/highlight.css">


  <!-- jquery3.3.1 -->
  <script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>

  <!-- fancybox -->
  <link href="https://cdn.bootcss.com/fancybox/3.5.2/jquery.fancybox.min.css" rel="stylesheet">
  <script async src="https://cdn.bootcss.com/fancybox/3.5.2/jquery.fancybox.min.js"></script>
  
<script src="/js/fancybox.js"></script>


  

<meta name="generator" content="Hexo 5.3.0"></head>


  <body>
    <div id="app">
      <div class="header">
  <div class="avatar">
    <a href="/">
      <!-- 头像取消懒加载，添加no-lazy -->
      
        <img src="/images/avatar.png" alt="">
      
    </a>
    <div class="nickname"><a href="/">JOON.DEV</a></div>
  </div>
  <div class="navbar">
    <ul>
      
        <li class="nav-item" data-path="/">
          <a href="/">Home</a>
        </li>
      
        <li class="nav-item" data-path="/archives/">
          <a href="/archives/">Archives</a>
        </li>
      
        <li class="nav-item" data-path="/categories/">
          <a href="/categories/">Categories</a>
        </li>
      
        <li class="nav-item" data-path="/tags/">
          <a href="/tags/">Tags</a>
        </li>
      
        <li class="nav-item" data-path="/about/">
          <a href="/about/">About</a>
        </li>
      
    </ul>
  </div>
</div>


<script src="/js/activeNav.js"></script>



      <div class="flex-container">
        <!-- 文章详情页，展示文章具体内容，url形式：https://yoursite/文章标题/ -->
<!-- 同时为「标签tag」，「朋友friend」，「分类categories」，「关于about」页面的承载页面，具体展示取决于page.type -->

<!-- LaTex Display -->
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script type="text/javascript" id="MathJax-script" async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js">
</script>
<script>
MathJax = {
  tex: {
    inlineMath: [['$', '$'], ['\\(', '\\)']]
  }
};
</script>



  

  

  

  
  <!-- 文章内容页 url形式：https://yoursite/文章标题/ -->
  <div class="container post-details" id="post-details">
    <div class="post-content">
      <div class="post-title">테스트 주도 개발의 패턴</div>
      <div class="post-attach">
        <span class="post-pubtime">
          <i class="iconfont icon-updatetime" title="Update time"></i>
          2021-02-11 21:01:33
        </span>
        
              <span class="post-categories">
                <i class="iconfont icon-bookmark" title="Categories"></i>
                
                <span class="span--category">
                  <a href="/categories/Book-TDD/" title="Book TDD">
                    <b>#</b> Book TDD
                  </a>
                </span>
                
              </span>
          
              <span class="post-tags">
                <i class="iconfont icon-tags" title="Tags"></i>
                
                <span class="span--tag">
                  <a href="/tags/%EC%86%8C%ED%94%84%ED%8A%B8%EC%9B%A8%EC%96%B4/" title="소프트웨어">
                    <b>#</b> 소프트웨어
                  </a>
                </span>
                
              </span>
          
      </div>
      <div class="markdown-body">
        <h1 id="테스트-주도-개발-패턴"><a href="#테스트-주도-개발-패턴" class="headerlink" title="테스트 주도 개발 패턴"></a>테스트 주도 개발 패턴</h1><p>테스트는 무엇이고,<br>테스트는 언제 해야 하고,<br>테스트 로직은 어떻게 고르고,<br>테스트할 데이터는 어떻게 고를 것인가?</p>
<h2 id="테스트-명사"><a href="#테스트-명사" class="headerlink" title="테스트(명사)"></a>테스트(명사)</h2><p>테스트하다(test) ‘평가하다’는 뜻의 동사이다. 테스트는 또한 ‘승인 또는 거부에 도달하는 과정’을 뜻하는 명사기도 하다.<br>명사로서의 테스트는 동사로서의 테스트와 다른 느낌을 받을 수 있는데, <strong>변화를 테스트한다는 것(수작업)은 테스트의 동사적 의미를 암시하고, 테스트를 갖고 있다(자동화)는 것은 명사적 의미</strong>를 암시할 수 있다.</p>
<p>만약, 테스트를 하는 것(수작업)의 대한 스트레스가 증가하게 되면 어떻게 될까?<br>스트레스를 많이 받으면 테스트를 점점 더 뜸하게 한다. 테스트를 뜸하게 하면 당신이 만드는 에러는 점점 많아질 것이고, 에러가 많아지면 더 많은 스트레스를 받게 된다.(양성 피드백 고리- ‘테스트할 시간이 없다’의 죽음의 나선)<br>이 경우에 ‘테스트’를 ‘자동화된 테스트’로 치환하게 되면 개선할 수 있다.</p>
<p>무엇인가 작업을 할 때 “내가 이걸 고치면서 뭔가 다른 부분을 망가트리지 않았을까?” 라고 생각할 때 자동화된 테스트가 있다면, 테스트를 받기 시작할 때 테스트를 실행할 것이다.<br>테스트를 실행하면 즉시 좋은 느낌을 받게 되고 그러면 작업 중에 에러를 낼 일도 줄게 되며, 스트레스도 적어진다.</p>
<p>“테스트할 시간이 어딨어. 그냥 릴리즈해!” 이 장면에 대해서는 결과를 보장할 수 없으며 스트레스를 점점 많이 받으며 결국 실패하게 된다.</p>
<h2 id="격리된-테스트"><a href="#격리된-테스트" class="headerlink" title="격리된 테스트"></a>격리된 테스트</h2><p><strong>테스트를 실행하는 것은 서로 아무 영향이 없어야 한다.</strong></p>
<p><strong>테스트는 전체 애플리케이션을 대상으로 하는 것보다 좀더 작은 스케일로 하는 게 좋다.</strong> 전체 애플리케이션 대상으로 하게 되면 시간이 너무 오래 걸리기 때문이다.</p>
<p>각 테스트는 주어진 문제를 작은 단위로 분리하기 위해 노력해 각 테스트를 실행하기 위한 환경을 쉽고 빠르게 세팅할 수 있게 해야 한다.<br>테스트를 격리하기 위한 작업은 결과적으로 시스템이 응집도는 높고 결합도는 낮은 객체의 모음으로 구성되도록 한다.</p>
<h2 id="테스트-목록"><a href="#테스트-목록" class="headerlink" title="테스트 목록"></a>테스트 목록</h2><p>시작하기 전에 작성해야 할 테스트 목록을 모두 적어두자.</p>
<ul>
<li>구현해야 할 것들에 대한 테스트를 목록에 적는다.</li>
<li>구현할 필요가 있는 모든 함수의 사용 예들을 적는다.</li>
<li>이미 존재하지 않는 함수에 대해서는 해당 함수의 널 버전을 목록에 적는다.</li>
<li>이번 작업을 끝내기 전에 반드시 해야 할 리팩토링의 목록을 적는다.</li>
</ul>
<p>테스트를 통과하게 만드는 과정에서 새로운 테스트가 필요함을 암시적으로 알려줄 것이다.<br>이 새 테스트를 리팩토링과 마찬가지로 목록에 적자.</p>
<h2 id="테스트-우선"><a href="#테스트-우선" class="headerlink" title="테스트 우선"></a>테스트 우선</h2><p>테스트 대상이 되는 코드를 작성하기 직전에 테스트를 작성하는 것이 좋다.</p>
<h2 id="단언-우선"><a href="#단언-우선" class="headerlink" title="단언 우선"></a>단언 우선</h2><ul>
<li>시스템을 개발할 때 무슨 일부터 하는가? 완료된 시스템이 어떨 거라고 알려주는 이야기부터 작성한다.</li>
<li>특정 기능을 개발할 때 무슨 일부터 하는가? 기능이 완료되면 통과할 수 있는 테스트부터 작성한다.</li>
<li>테스트를 개발할 때 무슨 일부터 하는가? 완료될 때 통과해야 할 단언부터 작성한다.</li>
</ul>
<p>단언을 먼저 작성함으로써 아주 작은 단계로 빠른 피드백을 받으며 테스트의 아웃라인을 만들 수 있다.</p>
<h2 id="테스트-데이터"><a href="#테스트-데이터" class="headerlink" title="테스트 데이터"></a>테스트 데이터</h2><ul>
<li>테스트를 읽을 때 따라가기 좋을 만한 데이터를 사용하라.</li>
<li>데이터 간에 차이가 있다면 그 속에 어떤 의미가 있어야 한다.</li>
<li>만약 시스템이 여러 입력을 다루어야 한다면 테스트 역시 여러 입력을 반영해야 한다. 하지만 세 항목만으로 동일한 설계와 구현을 이끌어낼 수 있다면 굳이 항목을 열 개나 나열할 필요는 없다.</li>
<li>테스트 데이터에 대한 대안은 실제 세상에서 얻어진 실제 데이터를 사용하는 것이다.<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">실제 데이터는 다음과 같은 경우에 유용하다.</span><br><span class="line">- 실제 실행을 통해 수집한 외부 이벤트의 결과를 이용하여 실시간 시스템을 테스트하고자 하는 경우.</span><br><span class="line">- 예전 시스템의 출력과 현재 시스템의 출력을 비교하고자 하는 경우(병렬 테스팅).</span><br><span class="line">- 시뮬레이션 시스템을 리팩토링한 후 기존과 정확히 동일한 결과가 나오는지 확인하고자 할 경우. 특히 부동소수점 값의 정확성이 문제가 될 수 있다.</span><br></pre></td></tr></table></figure>
<h2 id="명백한-데이터"><a href="#명백한-데이터" class="headerlink" title="명백한 데이터"></a>명백한 데이터</h2>테스트 자체에 예상되는 값과 실제 값을 포함하고 이 둘 사이의 관계를 드러내기 위해 노력하라.<br>테스트를 작성할 때는 컴퓨터뿐 아니라 후에 코드를 읽을 다른 사람들도 생각해야 한다.</li>
</ul>
<p>예를 들어, USD에서 GBP로 교환하는 환율이 2:1이고 수수료 1.5%가 붙는다면 $100는 50GBP - 1.5% = 49.25GBP가 되어야 한다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Bank bank = <span class="keyword">new</span> Bank(;</span><br><span class="line">bank.addRate(<span class="string">&quot;USD&quot;</span>, <span class="string">&quot;GBP&quot;</span>, STANDARD_RATE);</span><br><span class="line">bank.commission(STANDARD_COMMISSION);</span><br><span class="line">Money result = bank.convert(<span class="keyword">new</span> Note(<span class="number">100</span>, <span class="string">&quot;USD&quot;</span>), <span class="string">&quot;GBP&quot;</span>);</span><br><span class="line">assertEquals(<span class="keyword">new</span> Note(<span class="number">49.25</span>, <span class="string">&quot;GBP&quot;</span>), result);</span><br></pre></td></tr></table></figure>
<p>또는 계산을 더 명백하게 표현할 수 있다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Bank bank = <span class="keyword">new</span> Bank(;</span><br><span class="line">bank.addRate(<span class="string">&quot;USD&quot;</span>, <span class="string">&quot;GBP&quot;</span>, <span class="number">2</span>);</span><br><span class="line">bank.commission(<span class="number">0.015</span>);</span><br><span class="line">Money result = bank.convert(<span class="keyword">new</span> Note(<span class="number">100</span>, <span class="string">&quot;USD&quot;</span>), <span class="string">&quot;GBP&quot;</span>);</span><br><span class="line">assertEquals(<span class="keyword">new</span> Note(<span class="number">100</span> / <span class="number">2</span> * (<span class="number">1</span> - <span class="number">0.015</span>), <span class="string">&quot;GBP&quot;</span>), result);</span><br></pre></td></tr></table></figure>
<p>명백한 데이터를 통해 일단 수식을 써놓으면 어떻게든 나눗셈과 곱셈을 수행할 프로그램을 만들어야 한다는 것을 알수 있기 때문에 다음으로 무엇을 해야 할지 쉽게 알게 된다.<br>명백한 데이터는 코드에 매직넘버를 쓰지 말라는 것에 대한 예외적인 케이스일 수 있다. 단일 메서드라면 이미 정의된 기호 상수를 사용하는 것이 더 나을것이다.</p>
<hr>
<h1 id="빨간-막대-패턴"><a href="#빨간-막대-패턴" class="headerlink" title="빨간 막대 패턴"></a>빨간 막대 패턴</h1><p>이 패턴들은 테스트를 언제 어디에 작성할 것인지, 테스트 작성을 언제 멈출지에 대한 것이다.</p>
<h2 id="한-단계-테스트"><a href="#한-단계-테스트" class="headerlink" title="한 단계 테스트"></a>한 단계 테스트</h2><p>성장은 일종의 자기유사성을 가진 피드백 고리를 암시하는데, 이 피드백 고리에서는 환경이 프로그램에 영향을 주고 프로그램이 다시 환경에 영향을 준다.<br>만약 어떠한 방향성을 가질 필요가 있다면 ‘아는 것에서 모르는 것으로’라는 방향이 유용할 것이다. 우리가 어느 정도의 지식과 경험을 가지고 개발을 시작한다는 점, 개발 하는 중에 새로운 것으로 배우게 될 것임을 예상한다는 점 등을 암시한다.<br>위 두 가지를 통해 우리는 아는 것에서 모르는 것으로 성장하는 프로그램을 갖게 된다.</p>
<h2 id="시작-테스트"><a href="#시작-테스트" class="headerlink" title="시작 테스트"></a>시작 테스트</h2><p>테스트의 시작은 함수가 아무 일도 하지 않는 경우를 먼저 테스트하는 것이 좋다.<br>현실적인 테스트 하나로 시작하면 너무 오랫동안 피드백이 없을 것이다. 빨강/초록/리팩토링 주기가 몇 분이내로 반복되도록 하자.<br>정말 발견하기 쉬운 입력과 출력을 사용하면 이 시간을 짧게 줄일 수 있다.</p>
<p>한 단계 테스트는 시작 테스트에도 적용된다. 당신에게 뭔가를 가르쳐줄 수 있으면서도 빠르게 구현할 수 있는 테스트를 선택하라.</p>
<h2 id="설명-테스트"><a href="#설명-테스트" class="headerlink" title="설명 테스트"></a>설명 테스트</h2><p>자동화된 테스트가 더 널리 쓰이게 하려면 어떻게 해야 할까? 테스트를 통해 설명을 요청하고 테스트를 통해 설명하라.</p>
<h2 id="학습-테스트"><a href="#학습-테스트" class="headerlink" title="학습 테스트"></a>학습 테스트</h2><p>외부에서 만든 소프트웨어에 대한 테스트를 작성해야 할 때 패키지의 새로운 기능을 처음으로 사용해보기 전에 테스트 작성을 통해 익숙해질 수 있다.<br>그리고 패키지의 새 버전이 도착하면 우선 테스트를 실행해보고, 만약 통과되지 않는다면 애플리케이션을 실행해볼 필요도 없다.</p>
<h2 id="또-다른-테스트"><a href="#또-다른-테스트" class="headerlink" title="또 다른 테스트"></a>또 다른 테스트</h2><p>주제와 무관한 아이디어가 떠오르면 이에 대한 테스트를 할일 목록에 적어놓고 다시 주제로 돌아와라.<br>대화를 엄격하게 한 주제로 묶는 것은 훌륭한 아이디어를 억압하는 최고의 방법이다. 하지만 내가 가야 할 길을 놓치지 않아야 하며, 새 아이디어가 떠오르면 존중하고 맞이하되 그것이 내 주의를 흩뜨리지 않게 한다.<br>그 아이디어를 목록에 적어놓고는 하던 일로 다시 돌아간다.</p>
<h2 id="회귀-테스트"><a href="#회귀-테스트" class="headerlink" title="회귀 테스트"></a>회귀 테스트</h2><p>시스템 장애가 보고될 때 그 장애로 인하여 실패하는 테스트, 그리고 통과할 경우엔 장애가 수정되었다고 볼 수 있는 테스트를 가장 간단하게 작성해라.<br>시스템 장애를 손쉽게 격리시킬 수 없다면 리팩토링해야 한다.</p>
<h2 id="휴식"><a href="#휴식" class="headerlink" title="휴식"></a>휴식</h2><p>키보드로 뭘 쳐야 할지 알면, 명백한 구현을 한다.<br>잘 모르겠다면 가짜 구현을 한다.<br>올바른 설계가 명확하지 않다면 삼각측량 기법을 사용한다.<br>그래도 모르겍ㅆ다면 샤워나 하러 간다.</p>
<hr>
<h1 id="테스팅-패턴"><a href="#테스팅-패턴" class="headerlink" title="테스팅 패턴"></a>테스팅 패턴</h1><p>이 패턴들은 더 상세한 테스트 작성법에 대한 것이다.</p>
<h2 id="자식-테스트"><a href="#자식-테스트" class="headerlink" title="자식 테스트"></a>자식 테스트</h2><p>지나치게 큰 테스트 케이스의 깨지는 부분에 해당하는 작은 테스트 케이스를 작성하고 그 작은 테스트 케이스가 실행되도록 하라.<br>그 후에 다시 원래의 큰 테스트 케이스를 추가하라.</p>
<h2 id="모의-객체"><a href="#모의-객체" class="headerlink" title="모의 객체"></a>모의 객체</h2><p>비용이 많이 들거나 복잡한 리소스에 의존하는 객체를 테스트할 때 모의 객체를 사용해 이점을 얻을 수 있다.</p>
<p>한 예로 데이터베이스는 시작 시간도 오래 걸리고, 항상 깨끗한 상태로 유지하기가 어렵다. 또 만약 원격 서버에 있다면 성공 여부가 네트워크 상의 물리적 위치에 영향을 받을 수 있다.<br>이런 경우 <strong>실제 데이터베이스를 사용하는 것이 아닌 데이터베이스인 것처럼 행동하지만 실제로는 메모리에만 존재하는 모의 객체 생성</strong>을 통해 예상된 쿼리를 얻지 못 하면 에러를 반환하고, 올바르다면 결과 집합처럼 보이는 뭔가를 생성해 반환하여 <strong>성능과 견고함</strong>을 얻을 수 있다.<br>그리고 작성 되어 있는 테스트를 끝에서 끝까지 읽을 수 있기 때문에 가독성에도 도움을 받을 수 있다.</p>
<p>모의 객체가 진짜 객체와 동일하게 동작하지 않는 다는 것은 프로젝트의 위험 요소가 하나 추가되는 것이다.<br>모의 객체용 테스트 집합을 진짜 객체가 사용 가능해질 때 그대로 적용해서 이러한 위험을 줄일 수 있다.</p>
<h2 id="크래시-테스트-더미"><a href="#크래시-테스트-더미" class="headerlink" title="크래시 테스트 더미"></a>크래시 테스트 더미</h2><p>실제 작업을 수행하는 대신 그냥 예외를 발생시키기만 하는 특수한 객체를 만들어 호출되지 않을 것 같은 에러코드를 테스트 할 수 있다.</p>
<p>객체 전체를 흉내낼 필요가 없다는 점을 제외하면 크래시 테스트 더미는 모의 객체와 유사하다.<br>자바의 익명 내부 클래스는 우리가 테스트하기 원하는 적절한 메서드만이 오류를 발생키게끔 하기 위해 유용하다.<br>만약 파일 시스템에 여유 공간이 없을 경우 발생할 문제에 대해 테스트하기를 원할 때 익명 내부 클래스를 통해 필요한 함수만 가짜 구현을 통해 테스팅할 수 있다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFileSystemError</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    File f = <span class="keyword">new</span> File(<span class="string">&quot;foo&quot;</span>) &#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">createNewFile</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IOException();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        saveAs(f);</span><br><span class="line">        fail();</span><br><span class="line">    &#125; <span class="keyword">catch</span>(IOException e) &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="깨진-테스트"><a href="#깨진-테스트" class="headerlink" title="깨진 테스트"></a>깨진 테스트</h2><p>혼자서 프로그래밍할 때 프로그래밍 세션을 마지막 테스트가 깨진 상태로 끝마치는 것이 좋다.<br>나중에 다시 코딩하기위해 돌아왔을 때, 어느 작업부터 시작할 것인지 명백히 알 수 있다.</p>
<h2 id="깨끗한-체크인"><a href="#깨끗한-체크인" class="headerlink" title="깨끗한 체크인"></a>깨끗한 체크인</h2><p>팀 프로그래밍을 할 때는 프로그래밍 세션은 모든 테스트가 성공한 상태로 끝마치는 것이 좋다.<br>팀 프로젝트에서는 자신이 마지막으로 코딩한 다음부터 지금까지 무슨 일이 있었는지 세밀하게 알 수 없다. 안심이 되고 확신이 있는 상태에서 시작할 필요가 있다.</p>
<hr>
<h1 id="초록-막대-패턴"><a href="#초록-막대-패턴" class="headerlink" title="초록 막대 패턴"></a>초록 막대 패턴</h1><p>빨간 막대(실패한 테스트)를 가능한 빨리 초록 막대(성공한 테스트)로 옮기기 위해 이 패턴들을 사용하라.</p>
<h2 id="가짜로-구현하기-진짜로-만들기-전까지만"><a href="#가짜로-구현하기-진짜로-만들기-전까지만" class="headerlink" title="가짜로 구현하기(진짜로 만들기 전까지만)"></a>가짜로 구현하기(진짜로 만들기 전까지만)</h2><p>실패하는 테스트를 만든 후 첫 번째 구현은 어떻게 하는 게 좋을까?<br><strong>상수를 반환하게 하라</strong><br><strong>일단 테스트가 통과하면 단계적으로 상수를 변수를 사용하는 수식으로 변형한다</strong></p>
<p>가짜로 구현하기를 강력하게 만드는 두 가지 효과가 있다.</p>
<ul>
<li>심리학적 : 막대가 초록색일 때 현재 어느 위치에 있는지 알 수 있다. 또 확신을 갖고 거기부터 리팩토링해 갈 수 있다.</li>
<li>범위(Scope) 조절 : 다음 테스트 케이스를 구현할 때, 이전 테스트의 작동이 보장된다는 것을 알기 때문에 그 다음 테스트 케이스에도 집중할 수 있다.</li>
</ul>
<p>필요 없는 코드는 조금도 작성하지 말라는 법칙에 가짜로 구현하기가 위배되는 것처럼 보일 수 있지만 <strong>리팩토링 단계에서 테스트 케이스와 코드 간의 데이터 중복을 제거</strong> 함으로써 해결 할 수 있다.</p>
<h2 id="삼각-측량"><a href="#삼각-측량" class="headerlink" title="삼각 측량"></a>삼각 측량</h2><p>추상화 과정을 테스트로 주도할 때 최대한 보수적으로 하기 위해 오로지 예가 두 개 이상일 때에만 추상화를 하라.</p>
<p> 만약 두 정수의 합을 반환하는 함수를 작성할 때</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSum</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    assertEquasl(<span class="number">4</span>, plus(<span class="number">3</span>, <span class="number">1</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">plus</span><span class="params">(<span class="keyword">int</span> augend, <span class="keyword">int</span> addend)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">4</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>삼각측량을 사용해 바른 설계로 간다면 다음과 같이 작성해야 한다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSum</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    assertEquasl(<span class="number">4</span>, plus(<span class="number">3</span>, <span class="number">1</span>));</span><br><span class="line">    assertEquasl(<span class="number">7</span>, plus(<span class="number">3</span>, <span class="number">4</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>두 번째 예가 생겼을 때 plus() 구현을 추상화 할 수 있다</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">plus</span><span class="params">(<span class="keyword">int</span> augend, <span class="keyword">int</span> addend)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> augend + addend;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>두 단언을 만들었고 plus 가 바른 구현을 추상화했면, 두 단언은 중복이 되기 때문에 하나를 제거 할 수 있다.<br>하지만 그렇게 하면 우리는 다시 상수를 반환하는 것으로 단순화할 수 있는데 그렇게 되면 다시 단언을 하나 추가하고, 무한 루프를 만들어 낼 수 있다.<br>그렇기 때문에 어떤 계산을 어떻게 해야 올바르게 추상화할 것인지에 대한 정말 감잡기 어려울 때 삼각측량을 사용하면 도움을 받을 수 있다.<br>그 외의 경우 명백한 구현이나 가짜로 구현하기에 의존한다.</p>
<h2 id="명백한-구현"><a href="#명백한-구현" class="headerlink" title="명백한 구현"></a>명백한 구현</h2><p>단순한 연산들은 그냥 구현해 버려라.<br>가짜로 구현하기와 삼각측량은 눈곱만큼 작은 발걸음이다. 때때로 어떤 연산을 어떻게 구현해야 할지 확신이 들기도 한다. 그럼 그렇게 하라. plus() 만큼 간단한 것도 하나의 예가 된다.<br>그냥 명백한 구현을 입력하고 만약 빨간 막대를 보고 놀란다면 그제서야 좀더 작은 발걸음으로 옮겨가라.</p>
<p>‘제대로 동작하는’을 푸는 동시에 ‘깨끗한 코드’를 해결하는 것은 한번에 하기에는 너무 많은 일일 수 있다. 그렇게 되면 우선 ‘제대로 동작하는’으로 되돌아 가서 그걸 해결하고, 그 후에  ‘깨끗한 코드’를 느긋하게 해결하도록 하라.</p>
<h2 id="하나에서-여럿으로"><a href="#하나에서-여럿으로" class="headerlink" title="하나에서 여럿으로"></a>하나에서 여럿으로</h2><p>객체 컬렉션(collection)을 다루는 연산은 일단은 컬렉션없이 구현하고 그 다음에 컬렉션을 사용하게 한다.</p>
<hr>
<h1 id="xUnit-패턴"><a href="#xUnit-패턴" class="headerlink" title="xUnit 패턴"></a>xUnit 패턴</h1><p>xUnit 계열 테스팅 프레임워크를 위한 패턴이다.</p>
<h2 id="단언-assertion"><a href="#단언-assertion" class="headerlink" title="단언(assertion)"></a>단언(assertion)</h2><p>테스트가 잘 작동하는지 Boolean 수식을 작성해 프로그램이 자동으로 코드가 동작하는지에 대한 판단을 수행하도록 해라.</p>
<h2 id="픽스쳐"><a href="#픽스쳐" class="headerlink" title="픽스쳐"></a>픽스쳐</h2><p>객체들을 원하는 상태로 세팅하는 코드를 작성하고 이 객체들을 조작하고 결과를 볼 수 있도록 테스트하는 코드를 작성한다.(이러한 객체들을 <strong>테스트 픽스처</strong> 혹은 Scaffolding 이라 칭한다.)<br><strong>이와 같은 중복은 작성하는데 시간이 소요되고, 인터페이스를 수동으로 변경할 때 여러 테스트를 고쳐주어야 하기에 문제가 발생한다.</strong><br>이 문제는 공통 코드들을 setUp() 함수로 추출해 모든 테스트 케이스가 setUp 함수를 호출하도록 해 해결할 수 있다. 하지만 공통 함수에서 객체들이 어떻게 초기화 되었는지는 계속해서 기억하고 있어야 한다. </p>
<p>하지만, 중복에도 좋은 점은 존재한다. 객체 세팅 코드들이 단언이 적힌 메서드에 포함되면 테스트 코드를 위에서 아래로 읽어가며 이해하기에 훨씬 수월하다.</p>
<p>위 두 가지 스타일은 장단점이 있으며 어떤 스타일을 사용할지는 두 가지 모두 시도해보는 것이 좋다.</p>
<h2 id="외부-픽스처"><a href="#외부-픽스처" class="headerlink" title="외부 픽스처"></a>외부 픽스처</h2><p>만약 테스트 중에 파일을 열었다면 테스트가 끝나기 전에 이를 반드시 닫아야 한다.<br>아래와 같이 코드를 작성할 수 있다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">setUp(self):</span><br><span class="line">    self.file = File(<span class="string">&quot;foo&quot;</span>).<span class="built_in">open</span>()</span><br><span class="line">tesMethod(self):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        ...run the test...</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        self.file.close()</span><br></pre></td></tr></table></figure>
<p>하지만 이 코드를 여러 테스트에서 사용할 필요가 있다면, 귀찮은 중복이 될 수 있고 버그를 만들기 좋은 설계이다.</p>
<p>이렇게 픽스쳐 중 외부 자원이 있을 경우 xUnit이 제공하는 tearDown() 메서드를 재정의해 자원을 해제할 수 있다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">setUp(self):</span><br><span class="line">    self.file = File(<span class="string">&quot;foo&quot;</span>).<span class="built_in">open</span>()</span><br><span class="line">testMethod(self):</span><br><span class="line">    ...run the test...</span><br><span class="line">tearDown(self):</span><br><span class="line">    self.file.close()</span><br></pre></td></tr></table></figure>
      </div>
      
        <div class="prev-or-next">
          <div class="post-foot-next">
            
              <a href="/2020/11/11/2%EC%9E%A5%20%EA%B0%9D%EC%B2%B4%20%EC%83%9D%EC%84%B1%EA%B3%BC%20%ED%8C%8C%EA%B4%B4/" target="_self">
                <i class="iconfont icon-chevronleft"></i>
                <span>Prev</span>
              </a>
            
          </div>
          <div class="post-attach">
            <span class="post-pubtime">
              <i class="iconfont icon-updatetime" title="Update time"></i>
              2021-02-11 21:01:33
            </span>
            
                  <span class="post-categories">
                    <i class="iconfont icon-bookmark" title="Categories"></i>
                    
                    <span class="span--category">
                      <a href="/categories/Book-TDD/" title="Book TDD">
                        <b>#</b> Book TDD
                      </a>
                    </span>
                    
                  </span>
              
                  <span class="post-tags">
                    <i class="iconfont icon-tags" title="Tags"></i>
                    
                    <span class="span--tag">
                      <a href="/tags/%EC%86%8C%ED%94%84%ED%8A%B8%EC%9B%A8%EC%96%B4/" title="소프트웨어">
                        <b>#</b> 소프트웨어
                      </a>
                    </span>
                    
                  </span>
              
          </div>
          <div class="post-foot-prev">
            
          </div>
        </div>
      
    </div>
    
  <div class="post-catalog" id="catalog">
    <div class="title">Contents</div>
    <div class="catalog-content">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%ED%85%8C%EC%8A%A4%ED%8A%B8-%EC%A3%BC%EB%8F%84-%EA%B0%9C%EB%B0%9C-%ED%8C%A8%ED%84%B4"><span class="toc-text">테스트 주도 개발 패턴</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%ED%85%8C%EC%8A%A4%ED%8A%B8-%EB%AA%85%EC%82%AC"><span class="toc-text">테스트(명사)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%EA%B2%A9%EB%A6%AC%EB%90%9C-%ED%85%8C%EC%8A%A4%ED%8A%B8"><span class="toc-text">격리된 테스트</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%ED%85%8C%EC%8A%A4%ED%8A%B8-%EB%AA%A9%EB%A1%9D"><span class="toc-text">테스트 목록</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%ED%85%8C%EC%8A%A4%ED%8A%B8-%EC%9A%B0%EC%84%A0"><span class="toc-text">테스트 우선</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%EB%8B%A8%EC%96%B8-%EC%9A%B0%EC%84%A0"><span class="toc-text">단언 우선</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%ED%85%8C%EC%8A%A4%ED%8A%B8-%EB%8D%B0%EC%9D%B4%ED%84%B0"><span class="toc-text">테스트 데이터</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%EB%AA%85%EB%B0%B1%ED%95%9C-%EB%8D%B0%EC%9D%B4%ED%84%B0"><span class="toc-text">명백한 데이터</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%EB%B9%A8%EA%B0%84-%EB%A7%89%EB%8C%80-%ED%8C%A8%ED%84%B4"><span class="toc-text">빨간 막대 패턴</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%ED%95%9C-%EB%8B%A8%EA%B3%84-%ED%85%8C%EC%8A%A4%ED%8A%B8"><span class="toc-text">한 단계 테스트</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%EC%8B%9C%EC%9E%91-%ED%85%8C%EC%8A%A4%ED%8A%B8"><span class="toc-text">시작 테스트</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%EC%84%A4%EB%AA%85-%ED%85%8C%EC%8A%A4%ED%8A%B8"><span class="toc-text">설명 테스트</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%ED%95%99%EC%8A%B5-%ED%85%8C%EC%8A%A4%ED%8A%B8"><span class="toc-text">학습 테스트</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%EB%98%90-%EB%8B%A4%EB%A5%B8-%ED%85%8C%EC%8A%A4%ED%8A%B8"><span class="toc-text">또 다른 테스트</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%ED%9A%8C%EA%B7%80-%ED%85%8C%EC%8A%A4%ED%8A%B8"><span class="toc-text">회귀 테스트</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%ED%9C%B4%EC%8B%9D"><span class="toc-text">휴식</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%ED%85%8C%EC%8A%A4%ED%8C%85-%ED%8C%A8%ED%84%B4"><span class="toc-text">테스팅 패턴</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%EC%9E%90%EC%8B%9D-%ED%85%8C%EC%8A%A4%ED%8A%B8"><span class="toc-text">자식 테스트</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%EB%AA%A8%EC%9D%98-%EA%B0%9D%EC%B2%B4"><span class="toc-text">모의 객체</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%ED%81%AC%EB%9E%98%EC%8B%9C-%ED%85%8C%EC%8A%A4%ED%8A%B8-%EB%8D%94%EB%AF%B8"><span class="toc-text">크래시 테스트 더미</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%EA%B9%A8%EC%A7%84-%ED%85%8C%EC%8A%A4%ED%8A%B8"><span class="toc-text">깨진 테스트</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%EA%B9%A8%EB%81%97%ED%95%9C-%EC%B2%B4%ED%81%AC%EC%9D%B8"><span class="toc-text">깨끗한 체크인</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%EC%B4%88%EB%A1%9D-%EB%A7%89%EB%8C%80-%ED%8C%A8%ED%84%B4"><span class="toc-text">초록 막대 패턴</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%EA%B0%80%EC%A7%9C%EB%A1%9C-%EA%B5%AC%ED%98%84%ED%95%98%EA%B8%B0-%EC%A7%84%EC%A7%9C%EB%A1%9C-%EB%A7%8C%EB%93%A4%EA%B8%B0-%EC%A0%84%EA%B9%8C%EC%A7%80%EB%A7%8C"><span class="toc-text">가짜로 구현하기(진짜로 만들기 전까지만)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%EC%82%BC%EA%B0%81-%EC%B8%A1%EB%9F%89"><span class="toc-text">삼각 측량</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%EB%AA%85%EB%B0%B1%ED%95%9C-%EA%B5%AC%ED%98%84"><span class="toc-text">명백한 구현</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%ED%95%98%EB%82%98%EC%97%90%EC%84%9C-%EC%97%AC%EB%9F%BF%EC%9C%BC%EB%A1%9C"><span class="toc-text">하나에서 여럿으로</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#xUnit-%ED%8C%A8%ED%84%B4"><span class="toc-text">xUnit 패턴</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%EB%8B%A8%EC%96%B8-assertion"><span class="toc-text">단언(assertion)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%ED%94%BD%EC%8A%A4%EC%B3%90"><span class="toc-text">픽스쳐</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%EC%99%B8%EB%B6%80-%ED%94%BD%EC%8A%A4%EC%B2%98"><span class="toc-text">외부 픽스처</span></a></li></ol></li></ol>
    </div>
  </div>

  
<script src="/js/catalog.js"></script>




    
      <div class="comments-container">
        
  <div id="disqus_thread"></div>
  <script>

  /**
  *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
  *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
  /*
  var disqus_config = function () {
  this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
  this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
  };
  */
  (function() { // DON'T EDIT BELOW THIS LINE
  var d = document, s = d.createElement('script');
  s.src = 'https://https-jeonjoonho-github-io.disqus.com/embed.js';
  s.setAttribute('data-timestamp', +new Date());
  (d.head || d.body).appendChild(s);
  })();
  </script>
  <noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>






      </div>
    
  </div>


        <div class="footer">
  <div class="social">
    <ul>
      
        <li>
          <a title="github" target="_blank" rel="noopener" href="https://github.com/JeonJoonHo">
            <i class="iconfont icon-github"></i>
          </a>
        </li>
      
        <li>
          <a title="email" href="jeon9435@gmail.com">
            <i class="iconfont icon-envelope"></i>
          </a>
        </li>
      
    </ul>
  </div>
  
    <div class="footer-more">
      
        <a target="_blank" rel="noopener" href="https://github.com/JeonJoonHo">Copyright © Jeon Joon Ho 2021</a>
        
    </div>
  
    <div class="footer-more">
      
        <a target="_blank" rel="noopener" href="https://github.com/zchengsite/hexo-theme-oranges">Theme by Oranges | Powered by Hexo</a>
        
    </div>
  
</div>

      </div>

      <div class="back-to-top hidden">
  <a href="javascript: void(0)">
    <i class="iconfont icon-chevronup"></i>
  </a>
</div>


<script src="/js/backtotop.js"></script>



      
  <div class="search-icon" id="search-icon">
    <a href="javascript: void(0)">
      <i class="iconfont icon-search"></i>
    </a>
  </div>

  <div class="search-overlay hidden">
    <div class="search-content" tabindex="0">
      <div class="search-title">
        <span class="search-icon-input">
          <a href="javascript: void(0)">
            <i class="iconfont icon-search"></i>
          </a>
        </span>
        
          <input type="text" class="search-input" id="search-input" placeholder="Search...">
        
        <span class="search-close-icon" id="search-close-icon">
          <a href="javascript: void(0)">
            <i class="iconfont icon-close"></i>
          </a>
        </span>
      </div>
      <div class="search-result" id="search-result"></div>
    </div>
  </div>

  <script type="text/javascript">
    var inputArea = document.querySelector("#search-input")
    var searchOverlayArea = document.querySelector(".search-overlay")

    inputArea.onclick = function() {
      getSearchFile()
      this.onclick = null
    }

    inputArea.onkeydown = function() {
      if(event.keyCode == 13)
        return false
    }

    function openOrHideSearchContent() {
      let isHidden = searchOverlayArea.classList.contains('hidden')
      if (isHidden) {
        searchOverlayArea.classList.remove('hidden')
        document.body.classList.add('hidden')
        // inputArea.focus()
      } else {
        searchOverlayArea.classList.add('hidden')
        document.body.classList.remove('hidden')
      }
    }

    function blurSearchContent(e) {
      if (e.target === searchOverlayArea) {
        openOrHideSearchContent()
      }
    }

    document.querySelector("#search-icon").addEventListener("click", openOrHideSearchContent, false)
    document.querySelector("#search-close-icon").addEventListener("click", openOrHideSearchContent, false)
    searchOverlayArea.addEventListener("click", blurSearchContent, false)

    var searchFunc = function (path, search_id, content_id) {
      'use strict';
      var $input = document.getElementById(search_id);
      var $resultContent = document.getElementById(content_id);
      $resultContent.innerHTML = "<ul><span class='local-search-empty'>First search, index file loading, please wait...<span></ul>";
      $.ajax({
        // 0x01. load xml file
        url: path,
        dataType: "xml",
        success: function (xmlResponse) {
          // 0x02. parse xml file
          var datas = $("entry", xmlResponse).map(function () {
            return {
              title: $("title", this).text(),
              content: $("content", this).text(),
              url: $("url", this).text()
            };
          }).get();
          $resultContent.innerHTML = "";

          $input.addEventListener('input', function () {
            // 0x03. parse query to keywords list
            var str = '<ul class=\"search-result-list\">';
            var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
            $resultContent.innerHTML = "";
            if (this.value.trim().length <= 0) {
              return;
            }
            // 0x04. perform local searching
            datas.forEach(function (data) {
              var isMatch = true;
              var content_index = [];
              if (!data.title || data.title.trim() === '') {
                data.title = "Untitled";
              }
              var orig_data_title = data.title.trim();
              var data_title = orig_data_title.toLowerCase();
              var orig_data_content = data.content.trim().replace(/<[^>]+>/g, "");
              var data_content = orig_data_content.toLowerCase();
              var data_url = data.url;
              var index_title = -1;
              var index_content = -1;
              var first_occur = -1;
              // only match artiles with not empty contents
              if (data_content !== '') {
                keywords.forEach(function (keyword, i) {
                  index_title = data_title.indexOf(keyword);
                  index_content = data_content.indexOf(keyword);

                  if (index_title < 0 && index_content < 0) {
                    isMatch = false;
                  } else {
                    if (index_content < 0) {
                      index_content = 0;
                    }
                    if (i == 0) {
                      first_occur = index_content;
                    }
                    // content_index.push({index_content:index_content, keyword_len:keyword_len});
                  }
                });
              } else {
                isMatch = false;
              }
              // 0x05. show search results
              if (isMatch) {
                str += "<li><a href='" + data_url + "' class='search-result-title'>" + orig_data_title + "</a>";
                var content = orig_data_content;
                if (first_occur >= 0) {
                  // cut out 100 characters
                  var start = first_occur - 20;
                  var end = first_occur + 80;

                  if (start < 0) {
                    start = 0;
                  }

                  if (start == 0) {
                    end = 100;
                  }

                  if (end > content.length) {
                    end = content.length;
                  }

                  var match_content = content.substr(start, end);

                  // highlight all keywords
                  keywords.forEach(function (keyword) {
                    var regS = new RegExp(keyword, "gi");
                    match_content = match_content.replace(regS, "<span class=\"search-keyword\">" + keyword + "</span>");
                  });

                  str += "<p class=\"search-result-abstract\">" + match_content + "...</p>"
                }
                str += "</li>";
              }
            });
            str += "</ul>";
            if (str.indexOf('<li>') === -1) {
              return $resultContent.innerHTML = "<ul><span class='local-search-empty'>No result<span></ul>";
            }
            $resultContent.innerHTML = str;
          });
        },
        error: function(xhr, status, error) {
          $resultContent.innerHTML = ""
          if (xhr.status === 404) {
            $resultContent.innerHTML = "<ul><span class='local-search-empty'>The search.xml file was not found, please refer to：<a href='https://github.com/zchengsite/hexo-theme-oranges#configuration' target='_black'>configuration</a><span></ul>";
          } else {
            $resultContent.innerHTML = "<ul><span class='local-search-empty'>The request failed, Try to refresh the page or try again later.<span></ul>";
          }
        }
      });
      $(document).on('click', '#search-close-icon', function() {
        $('#search-input').val('');
        $('#search-result').html('');
      });
    }

    var getSearchFile = function() {
        var path = "/search.xml";
        searchFunc(path, 'search-input', 'search-result');
    }
  </script>




    </div>
  </body>
</html>
